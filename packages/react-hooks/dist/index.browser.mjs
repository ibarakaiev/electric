var w=Object.getOwnPropertySymbols;var y=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable;var d=(e,t)=>{var n={};for(var a in e)y.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(e!=null&&w)for(var a of w(e))t.indexOf(a)<0&&g.call(e,a)&&(n[a]=e[a]);return n};import{Shape as k,ShapeStream as R}from"@electric-sql/client";import U from"react";import{useSyncExternalStoreWithSelector as D}from"use-sync-external-store/with-selector.js";var S=new Map,i=new Map;async function J(e){let t=T(e),n=m(t);return await n.rows,n}function u(e){return typeof e=="function"?Function.prototype.toString.call(e):typeof e!="object"||e===null?e:Array.isArray(e)?e.map(u):Object.keys(e).sort().reduce((t,n)=>(t[n]=u(e[n]),t),{})}function f(e){return JSON.stringify(u(e))}function T(e){var a;let t=f(e);if(S.has(t)){let o=S.get(t);if(!((a=o.options.signal)!=null&&a.aborted))return o;S.delete(t),i.delete(o)}let n=new R(e);return S.set(t,n),n}function m(e){var n;if(i.has(e)){if(!((n=e.options.signal)!=null&&n.aborted))return i.get(e);S.delete(f(e.options)),i.delete(e)}let t=new k(e);return i.set(e,t),t}function O(e,t){let n=e.subscribe(t);return()=>{n()}}function p(e){return{data:e.currentRows,isLoading:e.isLoading(),lastSyncedAt:e.lastSyncedAt(),isError:e.error!==!1,shape:e,stream:e.stream,error:e.error}}function E(e,t){return!e||e.isLoading!==t.isLoading||e.lastSyncedAt!==t.lastSyncedAt||e.isError!==t.isError||e.error!==t.error||e.shape.lastOffset!==t.shape.lastOffset||e.shape.handle!==t.shape.handle}function b(e){return e}function K(n){var a=n,{selector:e=b}=a,t=d(a,["selector"]);let o=T(t),s=m(o);return U.useMemo(()=>{let r,c=()=>(r!=null||(r=p(s)),r),x=h=>{let l=p(s);return E(r,l)&&(r=l,h()),O(s,()=>{r=p(s),h()})};return()=>D(x,c,c,e)},[s,e])()}export{m as getShape,T as getShapeStream,J as preloadShape,f as sortedOptionsHash,K as useShape};
//# sourceMappingURL=index.browser.mjs.map